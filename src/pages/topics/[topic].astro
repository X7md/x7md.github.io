---
import tag from '@utility/tags'
export async function getStaticPaths() {
    const posts =  await Astro.glob('../blog/*.md');
    return [
            ... new Set(posts.map(post => post.frontmatter.tags)
            .flat()
            .map(tag => tag.toLowerCase().replaceAll(" ", "-")))
        ]
        .map(tag => {return {params: {topic: tag}}});
}
import BaseLayout from '@layouts/page.astro';
import Card from  "@components/Card.astro";
const data_ =  await Astro.glob('../blog/*.md');
const data = data_.sort((a, b) => new Date(b.frontmatter?.date) - new Date(a.frontmatter?.date))

const { topic } = Astro.params;
// const topicTitle = topic./*.charAt(0).toUpperCase() + topic.substr(1).*/toLowerCase();
const title = `تدوينات عن ${tag.get(topic.replaceAll("-", " "))?.name}`
---

<BaseLayout>
    <>
        <div class="text-right flex justify-center px-4 sm:px-6 md:px-8 py-3">
            <h2>{title}</h2>
        </div>
        <section class="flex flex-row flex-wrap items-center justify-center rounded">
            <ul>
            {

                 data.filter(post => !post.frontmatter.draft && Boolean(post.frontmatter.tags.find(tag => tag.toLowerCase().replaceAll(" ", "-") == topic))).map((post)=> {
                    return (
                        <li>
                        <Card
                        postURL={post.url}
                        postTitle={post.frontmatter.title}
                        postImage={post.frontmatter.image}
                        mainTag={post.frontmatter.tags[0]}/>
                        </li>
                    )
                 })
            }
            </ul>
        </section>
        <script
        set:html={
            JSON.stringify(
            {
                "@context": "https://schema.org",
                "@type": "ItemPage",
                "name": "تدوينات عن " + tag.get(topic.replaceAll("-", " "))?.name,
                "description": "مجموعة تدوينات تتناول موضوع " + tag.get(topic.replaceAll("-", " "))?.name,
                "license": "http://creativecommons.org/licenses/by-nc-sa/3.0/us/deed.en_US"
            }
            )
        }
         type="application/ld+json">
        </script>
    </>
</BaseLayout>
